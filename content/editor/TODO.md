# 编辑器待办事项

## 已完成 ✅

### 🏗️ 架构重构 (core/)
**核心模块：**
- [x] TimeController - 统一时间控制（播放状态、时间同步）
- [x] TrackManager - 轨道数据管理（片段CRUD、查询、颜色）
- [x] EditorCore - 整合层（协调时间和轨道、撤销/重做）
- [x] EditorState - 兼容层（代理到核心模块，保持旧代码兼容）

**timeline.js 重构：**
- [x] 业务逻辑委托给核心模块（addClip, moveClip, deleteClip, cutAtPlayhead）
- [x] 轨道操作委托（addTrack, removeTrack）
- [x] 选择操作委托（selectClip, clearSelection）
- [x] 查询方法委托（getCurrentClip, getActiveClipsAtTime）
- [x] 删除冗余代码（timelineToSource, sourceToTimeline）
- [x] 代码行数：1165 → 986（减少 15%）

### 🎬 Canvas 合成播放器 (compositor.js)
**核心设计：**
- 使用 Canvas 2D 渲染，完全自主控制
- 所有轨道都可以自由放置片段（包括主轨道）
- 按时间轴播放，每帧检查所有轨道的活动片段

**播放逻辑：**
```
时间轴: 0----1----2----3----4----5----6----7----8
V1:     [===视频A===]          [===视频C===]
V2:          [===视频B===]               [===视频D===]

播放时:
- 0-1秒: 只显示视频A（全屏）
- 1-2秒: 视频A + 视频B（画中画）
- 2-3秒: 只显示视频B（全屏）
- 3-4秒: 黑屏
- 4-6秒: 只显示视频C
- 6-7秒: 视频C + 视频D
- 7-8秒: 只显示视频D
```

**已实现：**
- [x] Canvas 渲染引擎
- [x] 多视频源管理
- [x] 自由轨道布局（所有轨道都可以留空）
- [x] 画中画叠加显示
- [x] 位置/大小/透明度控制
- [x] 音频同步（播放最底层有内容的轨道音频）

### 📐 片段编辑
- [x] 片段拖拽移动（跨轨道）
- [x] 片段裁剪手柄
- [x] 片段复制/粘贴
- [x] 多选和批量删除

### 📐 片段裁剪手柄
- [x] 拖拽片段左右边缘调整入点/出点
- [x] 主轨道和叠加轨道都支持裁剪
- [x] 实时预览裁剪效果

## 中优先级

### 🔊 音频波形显示
- [ ] 显示真实音频波形而非模拟波形

### ⌨️ 更多快捷键
- [x] 片段复制/粘贴 (Ctrl+C/V)
- [x] 快速复制 (Ctrl+D)
- [x] 多选片段 (Shift+点击)
- [x] 批量删除选中片段

### 🔍 时间轴缩放
- [x] 缩放按钮 (+/-/适应)
- [x] Ctrl+滚轮缩放

### 🧲 吸附对齐
- [x] 片段边缘自动吸附
- [x] 吸附到播放头位置
- [x] 吸附开关按钮

### 🎵 音频混合
- [ ] 多轨道音频混合
- [ ] 独立音量控制

## 低优先级

### 🎨 视频滤镜/特效
- [ ] 亮度/对比度/饱和度调整
- [ ] 模糊/锐化效果

### 🔀 转场效果
- [ ] 淡入淡出
- [ ] 滑动切换

### 📝 文字叠加
- [ ] 添加文字图层
- [ ] 字体/颜色/位置设置
